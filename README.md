# spring-business-process
Последовательное исполнение бизнес-процессов.

## Описание

Библиотека необходима для быстрой конфигурации асинхронного исполнения бизнес-процессов с передачей произвольных объектов данных между стадиями обработки.

Бизнес-процессы состоять из 1,2,3..N фаз обработки, переходы между которыми совершаются по ребрам `SUCCESS` и `ERROR`.

Конфигурация стадий и переходов находится в базе данных приложения, поэтому их переконфигурация может происходить без перезапуска приложения.

Все бизнес-процессы будут исполняться последовательно и асинхронно.

## Начало работы

### Необходимые миграции

##### Базовые миграции 

Добавляем в миграции приложения файлы [create-business-process-table.sql](src/main/resources/liquibase/migrations/create-business-process-table.sql) и [create-dbqueue-table.sql](src/main/resources/liquibase/migrations/create-dbqueue-table.sql)

##### Стадии бизнес-процессов

```
INSERT INTO business_process_stage(id, name) values
(1, 'DOWNLOAD_TABLES'),
(2, 'PARSING_TABLES'),
(3, 'COMPUTE_TABLE_DIFFS'),
(4, 'PUBLISH_TABLE_DIFFS'),
(5, 'NOTIFY_ERROR');
```

##### Переходы между стадиями бизнес-процессов (SUCCESS, ERROR).
```
INSERT INTO business_process_edge(from_stage_id, to_stage_id, result) values
(1, 2, 'SUCCESS'),
(2, 3, 'SUCCESS'),
(3, 4, 'SUCCESS'),
(1, 5, 'ERROR'),
(2, 5, 'ERROR'),
(3, 5, 'ERROR');
```

### Реализация обработчиков

После написания миграций и интеграции базовых таблиц в приложение, необходимо реализовать интерфейсы-обработчиков стадий бизнес-процессов.

Интерфейс `StageExecutor` выполняет роль обработчика, привязанного к определенной фазе бизнес-процесса.

В качестве generic-параметра `P` интерфейс принимает класс пейлоада, который хранит в себе необходимые для обработки данные.

Метод `getStageName()` должен быть сопоставим с одной из стадий обработки, присутствующей в базе данных.

Метод `getPayloadClass()` должен быть аналогичен классу, который представлен в виде generic-параметра реализации.

Метод `execute()` представляет собой исполнение фазы бизнес-процесса. Это может быть выполнение дорогостоящих операций базы данных, либо походы во внешние сервисы.


### Включение обработки бизнес-процессов.

Для включения и выключения обработки библиотека предосталяет аннотацию `@EnableBusinessProcess`.

Достаточно разместить аннотацию над базовым классом приложения.

### Наблюдаемость

Для большей наблюдаемости библиотека предоставляет панель предоставляет пользователю панель администратора.
Она доступна по URL `localhost:8080/processes`. В ней отражена информация о всех бизнес-процессах, находящихся в базе данных приложения, а также о стадиях их исполнения.


### Примеры использования

Один из примеров реализаций библиотека содержится в ветке `example`.
